<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SA Lotto Historical Results Viewer</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="app">
      <header>
        <h1>Lotto Results Explorer</h1>
        <p>Analyze historical South African Lotto data with ease.</p>
      </header>

      <main class="three-col-layout">
        <!-- LEFT COLUMN: Controls + Historical Data -->
        <div class="col-left">
          <section id="controls" class="glass">
            <div class="control-group file-upload-group">
              <label for="fileInput" class="btn primary"
                >Upload Data File</label
              >
              <input
                type="file"
                id="fileInput"
                accept=".xlsx, .xls, .csv, .txt"
                hidden
              />
              <span id="fileNameDisplay">No file selected</span>
            </div>

            <div class="control-grid">
              <div class="control-item">
                <label for="searchInput">Search Results</label>
                <input
                  type="text"
                  id="searchInput"
                  placeholder="Search draw, numbers..."
                />
              </div>
              <div class="control-item">
                <label>Date Range Filter</label>
                <div class="date-range">
                  <input type="date" id="dateFrom" />
                  <span>to</span>
                  <input type="date" id="dateTo" />
                </div>
              </div>
              <div class="control-item">
                <label for="sortOrder">Sort by Date</label>
                <select id="sortOrder">
                  <option value="asc">Oldest First</option>
                  <option value="desc" selected>Newest First</option>
                </select>
              </div>
            </div>

            <div id="manualEntry" class="manual-entry-section">
              <h3>Add Manual Result</h3>
              <div class="manual-entry-row">
                <div class="numbers-group">
                  <input
                    type="number"
                    id="num1"
                    min="1"
                    placeholder="#"
                    class="num-input"
                  />
                  <input
                    type="number"
                    id="num2"
                    min="1"
                    placeholder="#"
                    class="num-input"
                  />
                  <input
                    type="number"
                    id="num3"
                    min="1"
                    placeholder="#"
                    class="num-input"
                  />
                  <input
                    type="number"
                    id="num4"
                    min="1"
                    placeholder="#"
                    class="num-input"
                  />
                  <input
                    type="number"
                    id="num5"
                    min="1"
                    placeholder="#"
                    class="num-input"
                  />
                  <input
                    type="number"
                    id="num6"
                    min="1"
                    placeholder="#"
                    class="num-input"
                  />
                </div>
                <div class="bonus-group">
                  <span class="plus-sign">+</span>
                  <input
                    type="number"
                    id="manualBonus"
                    min="1"
                    placeholder="B"
                    class="bonus-input"
                  />
                </div>
                <button id="addManualBtn" class="btn primary small-btn">
                  Add
                </button>
                <button id="clearDataBtn" class="btn secondary small-btn">
                  Clear
                </button>
              </div>
            </div>

            <div id="formattingRules" class="formatting-options">
              <h3>Display Options</h3>
              <div class="checkbox-group">
                <label
                  ><input type="checkbox" id="ruleNumberRanges" checked />
                  Number Grouping</label
                >
                <label
                  ><input type="checkbox" id="ruleBonusBall" checked /> Bonus
                  Ball</label
                >
                <label
                  ><input type="checkbox" id="ruleJackpot" checked /> Jackpot
                  Rows</label
                >
                <label
                  ><input type="checkbox" id="ruleSpecialDates" checked />
                  Recent Draws</label
                >
              </div>
              <div class="legend">
                <div class="legend-item">
                  <div
                    class="legend-color"
                    style="background: var(--range-low)"
                  ></div>
                  <span>Low (1-14)</span>
                </div>
                <div class="legend-item">
                  <div
                    class="legend-color"
                    style="background: var(--range-med)"
                  ></div>
                  <span>Med (15-28)</span>
                </div>
                <div class="legend-item">
                  <div
                    class="legend-color"
                    style="background: var(--range-med-high)"
                  ></div>
                  <span>MH (29-42)</span>
                </div>
                <div class="legend-item">
                  <div
                    class="legend-color"
                    style="background: var(--range-high)"
                  ></div>
                  <span>High (43-58)</span>
                </div>
              </div>
            </div>
          </section>

          <section id="tableContainer" class="glass">
            <div class="table-actions">
              <div id="tableStats" class="table-stats">
                Imported: 0 rows | Valid draws: 0 | Showing: 0
              </div>
              <button id="exportCsvBtn" class="btn secondary small-btn" disabled>
                Export Visible Results (CSV)
              </button>
            </div>
            <div class="table-wrapper">
              <table id="resultsTable">
                <thead>
                  <tr id="tableHeader"></tr>
                </thead>
                <tbody id="tableBody"></tbody>
              </table>
            </div>
            <div id="loader" class="hidden">Parsing Excel Data...</div>
            <div id="noData" class="hidden">
              <p>No results found matching your filters.</p>
            </div>
          </section>
        </div>

        <!-- MIDDLE COLUMN: Prediction Engine -->
        <div class="col-middle">
          <section id="predictionPanel" class="glass hidden">
            <div class="pred-header">
              <h2 class="section-title">Prediction Engine</h2>
              <div class="pred-header-actions">
                <button id="exportDiagnosticsBtn" class="btn secondary" disabled>
                  Export Diagnostics
                </button>
                <button id="generateCandidatesBtn" class="btn secondary" disabled>
                  Generate Candidates
                </button>
                <button id="rerunPrediction" class="btn primary rerun-btn">
                  ‚ü≥ Rerun
                </button>
              </div>
            </div>
            <div id="predictionWarning" class="warning-banner">
              <div id="predictionWarningText">Ready</div>
              <div id="predictionProgressWrap" class="prediction-progress hidden">
                <div
                  id="predictionProgressTrack"
                  class="prediction-progress-track"
                  role="progressbar"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  aria-valuenow="0"
                >
                  <div
                    id="predictionProgressBar"
                    class="prediction-progress-bar"
                  ></div>
                </div>
              </div>
            </div>

            <div id="liveTrainingTracePanel" class="pred-card live-trace hidden">
              <h3>Live Training Trace</h3>
              <div id="liveTrainingTraceContent" class="live-trace-content">
                <div class="trace-empty">Waiting for live validation samples...</div>
              </div>
            </div>

            <div class="pred-grid">
              <div class="pred-card">
                <h3>Bias Diagnostics</h3>
                <div id="diagContent"></div>
              </div>
              <div class="pred-card">
                <h3>Backtest Results</h3>
                <div id="backtestContent"></div>
              </div>
            </div>

            <div class="pred-card">
              <h3>Hot & Cold Numbers (Last 20 Draws)</h3>
              <div id="hotColdGrid" class="number-grid"></div>
            </div>

            <div class="pred-card">
              <h3>Top Co-occurring Pairs</h3>
              <div id="topPairsContent"></div>
            </div>

            <div class="pred-card">
              <h3>Most Common Group Patterns (L-M-MH-H)</h3>
              <div id="groupPatternsContent"></div>
            </div>

            <div class="pred-card highlight-card">
              <h3>Predicted Next Draw Candidates</h3>
              <div id="predictedSets"></div>
            </div>
          </section>
        </div>

        <!-- RIGHT COLUMN: Control Panel + Backtest Lab -->
        <div class="col-right">
          <section id="modelSettingsPanel" class="glass">
            <div class="pred-header">
              <h2 class="section-title">Model Control Panel</h2>
            </div>
            <div class="model-section">
              <h3>Training / Validation</h3>
              <div class="model-grid">
                <div class="control-item">
                  <label for="settingTrainRatio">Train Ratio</label>
                  <input
                    id="settingTrainRatio"
                    type="number"
                    min="0.5"
                    max="0.95"
                    step="0.05"
                    value="0.8"
                  />
                </div>
                <div class="control-item">
                  <label for="settingBacktestRefresh">Backtest Refresh Every N Draws</label>
                  <input
                    id="settingBacktestRefresh"
                    type="number"
                    min="2"
                    max="30"
                    placeholder="Auto"
                  />
                </div>
                <div class="control-item">
                  <label for="settingTargetLatencyMs">Target Latency (ms)</label>
                  <input
                    id="settingTargetLatencyMs"
                    type="number"
                    min="400"
                    max="8000"
                    step="100"
                    value="1400"
                  />
                </div>
                <div class="control-item model-check">
                  <label><input id="settingFastMode" type="checkbox" /> Fast Mode</label>
                </div>
                <div class="control-item model-check">
                  <label><input id="settingContinuousTraining" type="checkbox" checked /> Continuous Self-Training</label>
                </div>
                <div class="control-item">
                  <label for="settingTargetSequenceMatch">Target Sequence Match</label>
                  <input
                    id="settingTargetSequenceMatch"
                    type="number"
                    min="1"
                    max="6"
                    step="1"
                    value="6"
                  />
                </div>
                <div class="control-item">
                  <label for="settingMaxOptimizationRounds">Max Optimization Rounds (0 = no cap)</label>
                  <input
                    id="settingMaxOptimizationRounds"
                    type="number"
                    min="0"
                    step="1"
                    value="10"
                  />
                </div>
                <div class="control-item model-check">
                  <label
                    ><input id="settingMasteryBacktestMode" type="checkbox" />
                    Sequence Mastery Backtest</label
                  >
                </div>
                <div class="control-item">
                  <label for="settingMasteryMaxAttemptsPerSequence"
                    >Max Attempts / Sequence (0 = no cap)</label
                  >
                  <input
                    id="settingMasteryMaxAttemptsPerSequence"
                    type="number"
                    min="0"
                    step="1"
                    value="180"
                  />
                </div>
                <div class="control-item">
                  <label for="settingMasteryGlobalAttemptCap"
                    >Global Attempt Cap (0 = no cap)</label
                  >
                  <input
                    id="settingMasteryGlobalAttemptCap"
                    type="number"
                    min="0"
                    step="1"
                    value="20000"
                  />
                </div>
                <div class="control-item">
                  <label for="settingMasteryProgressEveryAttempts"
                    >Mastery Progress Every N Attempts</label
                  >
                  <input
                    id="settingMasteryProgressEveryAttempts"
                    type="number"
                    min="1"
                    step="1"
                    value="8"
                  />
                </div>
              </div>
            </div>

            <div class="model-section">
              <h3>Candidate Generation</h3>
              <div class="model-grid">
                <div class="control-item model-check">
                  <label><input id="settingEnableMonteCarlo" type="checkbox" checked /> Monte Carlo</label>
                </div>
                <div class="control-item model-check">
                  <label><input id="settingEnableGenetic" type="checkbox" checked /> Genetic Optimizer</label>
                </div>
                <div class="control-item model-check">
                  <label><input id="settingEnableHistoricalEcho" type="checkbox" checked /> Historical Echo</label>
                </div>
                <div class="control-item model-check">
                  <label><input id="settingEnableSlidingWindow" type="checkbox" checked /> Sliding Window</label>
                </div>
              </div>
            </div>

            <div class="model-section">
              <h3>Search Budgets</h3>
              <div class="model-grid">
                <div class="control-item">
                  <label for="settingMonteCarloMin">MC Min Trials</label>
                  <input
                    id="settingMonteCarloMin"
                    type="number"
                    min="100"
                    max="50000"
                    step="100"
                    placeholder="Auto"
                  />
                </div>
                <div class="control-item">
                  <label for="settingMonteCarloMax">MC Max Trials</label>
                  <input
                    id="settingMonteCarloMax"
                    type="number"
                    min="500"
                    max="100000"
                    step="100"
                    placeholder="Auto"
                  />
                </div>
                <div class="control-item">
                  <label for="settingGeneticGenerations">GA Generations</label>
                  <input
                    id="settingGeneticGenerations"
                    type="number"
                    min="5"
                    max="200"
                    step="1"
                    placeholder="Auto"
                  />
                </div>
                <div class="control-item">
                  <label for="settingGeneticPopulation">GA Population</label>
                  <input
                    id="settingGeneticPopulation"
                    type="number"
                    min="20"
                    max="600"
                    step="5"
                    placeholder="Auto"
                  />
                </div>
              </div>
            </div>

            <div class="control-actions">
              <button id="stopTrainingBtn" class="btn secondary">
                Stop Training
              </button>
              <button id="applyModelSettingsBtn" class="btn primary">
                Apply Settings & Retrain
              </button>
            </div>
          </section>

          <section id="backtestLabPanel" class="glass hidden">
            <div class="pred-header">
              <h2 class="section-title">Backtest Lab</h2>
            </div>
            <div class="pred-card">
              <h3>Learning Progress</h3>
              <div id="learningProgressContent"></div>
            </div>
            <div class="pred-card">
              <h3>Step-by-Step Validation</h3>
              <div
                id="backtestRowsContent"
                style="max-height: 800px; overflow-y: auto"
              ></div>
            </div>
          </section>
        </div>
      </main>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
